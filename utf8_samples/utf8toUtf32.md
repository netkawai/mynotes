ただし、Unicodeは合字、異字体等から、コード数!=文字数である。 

ループ 

(UTF-8は可変長文字列(ストリーム)だが、開始点が特定できる。) 

1byte目を取得(c1) 

if(c1 < 0x80) // ASCII領域{ 

     0x000000 - 0x10007F 

    UTF-8(1byte code) 

} 

else if(残り長さが２以上かつ(c1 & 0xe0) == 0xc0 ){ 

     2byte目を取得(c2) 

     if( (c2 & 0xc0) == 0x80 ){ 

               // 2byte目が条件を満たす 

               0x000080 - 0x0007FF  

               UTF-8(2byte code) 

                

               // ただし1byte目が下記の条件の場合、0x80以上にならない 

               if((c1 & 0x1e) == 0 ){ 

                    エラー 

               } 

     } 

} 

else if(残り長さが３以上かつ(c1 & 0xf0) == 0xe0 ){ 

     2byte目を取得(c2) 

     3byte目を取得(c3) 

     if( (c2 & 0xc0) == 0x80 && (c3 & 0xc0) == 0x80 ){ 

          // 2byte目,3byte目が条件を満たす 

          0x000800-0x00FFFF 

          UTF-8(3byte) 

          if( (c1 & 0x0f) == 0 && (c2 & 0x20) == 0 ){ 

               エラー 

          } 

          if((c0 & 0x0f) == 0x0d && (c1 & 0x20) != 0 ){ 

               エラー 

          } 

     } 

} 

else if(残り長さが4以上かつ(c1 & 0xf8) == 0xf0){ 

     2byte目を取得(c2) 

     3byte目を取得(c3) 

     4byte目を取得(c4) 

     if( (c2 & 0xc0) == 0x80 && (c3 & 0xc0) == 0x80 && (c4 & 0xc0) == 0x80 ){ 

          0x010000-0x10FFFF 

          UTF-8(4byte) 

           if( (c1 & 0x07) == 0 && (c2 & 0x30) == 0 ){ 

               エラー 

           } 

           if( (c1 & 0x04) != 0 && ((c1 & 0x03) != 0 || (c2 & 0x30) != 0) ){ 

               エラー 

           } 

     } 

} 